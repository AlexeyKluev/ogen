{{ define "req_enc_json"}}
buf := json.GetBuffer()
e := json.GetEncoder()
defer json.PutEncoder(e)
{{ template "enc_json" req_enc_elem $ }}
if _, err := e.WriteTo(buf); err != nil {
	json.PutBuffer(buf)
	return nil, err
}
{{ end }}

{{- /*gotype: github.com/ogen-go/ogen/internal/gen.TemplateConfig*/ -}}
{{ define "req_enc" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

{{/* Range over all methods */}}
{{- range $op := $.Operations }}
{{- if $op.Request }}
{{- range $contentType, $type := $op.Request.Contents }}
func encode{{ $op.Name }}Request{{ $contentType.Name }}(req {{ $op.Request.Type.Go }}, span trace.Span) (data {{ $contentType.EncodedDataTypeGo }}, err error) {
	{{- if $type.IsStream }}
	return req, nil
	{{- else if $contentType.JSON }}
	{{- template "req_enc_json" $type }}
	return buf, nil
	{{- else }}
	return nil, errors.New(`{{ $contentType }} encoder not implemented`)
	{{- end }}
}
{{- end }}
{{- end }}
{{ end }}
{{/* Range over all methods */}}

{{ end }}
