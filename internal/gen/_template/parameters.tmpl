{{- /*gotype: github.com/ernado/ogen/internal/gen.config*/ -}}

{{ define "parameters" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

{{- range $m := $.Server.Methods }}
{{ if $m.Parameters }}
type {{ $m.Name }}Parameters struct {
	{{- range $t, $params := $m.Parameters }}
		{{ $t }} {{ $m.Name }}{{ $t }}Parameters
	{{- end}}
}
{{ range $t, $params := $m.Parameters }}
type {{ $m.Name }}{{ $t }}Parameters struct {
	{{- range $p := $params }}
		{{ $p.Name }} {{ $p.Type }}
	{{- end }}
}
{{ end }}

func Parse{{ $m.Name }}Parameters(r *http.Request) (*{{ $m.Name }}Parameters, error) {
	var parameters {{ $m.Name }}Parameters
	{{ range $t, $params := $m.Parameters }}
		{{- range $p := $params }}
		{
			{{- if eq $t "Query" }}
				param := r.URL.Query().Get("{{ $p.SourceName }}")
			{{- else if eq $t "Path" }}
				param := chi.URLParam(r, "{{ $p.SourceName }}")
			{{- else }}
				return fmt.Errorf("unsupported param type %s", "{{ $t }}")
			{{- end }}

			{{ if eq $p.Type "int64" }}
				v, err := strconv.ParseInt(param, 10, 64)
				if err != nil {
					return nil, fmt.Errorf("param {{ $t }} {{ $p.SourceName }} parse: %w", err)
				}
			{{ else if eq $p.Type "string" }}
				v := param
			{{- else }}
				return nil, fmt.Errorf("unsupported param value type %s", "{{ $p.Type }}")
			{{- end }}

			parameters.{{ $t }}.{{ $p.Name }} = v
		}
		{{- end }}
	{{- end }}

	return &parameters, nil
}
{{- end }}
{{- end }}

{{ end }}