{{ define "validate_array" }}
{{- /*Variables*/}}
{{- $schema := index . "schema" }}
{{- $varname := index . "varname" }}
{{- $errorPrefix := index . "errorPrefix" }}
{{- if not $errorPrefix }}{{ $errorPrefix = "" }}{{ end }}
{{- /*Variables*/}}

{{- if eq $schema.Kind "array" }}
{{- if $schema.MinItems }}{{/*MinItems*/}}
if len({{ $varname }}) < {{ $schema.MinItems }} {
    return fmt.Errorf("{{ $errorPrefix }}array must contain at least {{ $schema.MinItems }} items")
}
{{- end }}{{/*MinItems*/}}
{{- if $schema.MaxItems }}{{/*MaxItems*/}}
if len({{ $varname }}) > {{ $schema.MaxItems }} {
    return fmt.Errorf("{{ $errorPrefix }}array must contain at most {{ $schema.MaxItems }} items")
}
{{- end }}{{/*MaxItems*/}}
{{- end }}

{{- if $schema.Item.NeedValidation }}
for i, item := range {{ $varname }} {
    if err := func() error {
        {{- template "validate_schema" dict
            "schema" $schema.Item
            "varname" "item"
        }}
        return nil
    }(); err != nil {
        return fmt.Errorf("{{ $errorPrefix }}item %d: %w", i, err)
    }
}
{{- end }}
{{- end }}