{{- /*gotype: github.com/ogen-go/ogen/internal/gen.config*/ -}}

{{ define "responses" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

{{/* Range over all methods */}}
{{- range $m := $.Methods }}

func Encode{{ $m.Name }}Response(response {{ $m.ResponseType }}, w http.ResponseWriter) error {
    {{- $schemasLength := len $m.ListResponseSchemas }}
    {{- if eq $schemasLength 1 }}

    {{- range $schema, $info := $m.ListResponseSchemas }}
        {{- /* Set status code */}}
        {{- if $info.Default }}
        w.WriteHeader(response.StatusCode)
        {{- else }}
        w.WriteHeader({{ $info.StatusCode }})
        {{- end }}
        {{- /* Set status code */}}

        {{- /* Encode content */}}
        {{- if $info.NoContent }}
        return nil
        {{- else }}
        w.Header().Set("Content-Type", "{{ $info.ContentType }}")
        {{- if eq $info.ContentType "application/json" }}
        return json.NewEncoder(w).Encode(response)
        {{- else }}
        return fmt.Errorf("{{ $info.ContentType }} encoder not implemented")
        {{- end }}
        {{- end }}
        {{- /* Encode content */}}
    {{- end }}

    {{- else }}
    switch response := response.(type) {
    {{- range $schema, $info := $m.ListResponseSchemas }}
    case *{{ $schema.Name }}:
        {{- /* Set status code */}}
        {{- if $info.Default }}
        w.WriteHeader(response.StatusCode)
        {{- else }}
        w.WriteHeader({{ $info.StatusCode }})
        {{- end }}
        {{- /* Set status code */}}

        {{- /* Encode content */}}
        {{- if $info.NoContent }}
        return nil
        {{- else }}
        w.Header().Set("Content-Type", "{{ $info.ContentType }}")
        {{- if eq $info.ContentType "application/json" }}
        return json.NewEncoder(w).Encode(response)
        {{- else }}
        return fmt.Errorf("{{ $info.ContentType }} encoder not implemented")
        {{- end }}
        {{- end }}
        {{- /* Encode content */}}
    {{- end }}
    default:
        return fmt.Errorf("{{ $m.Path}}: unexpected response type for method: %T", response)
    }
    {{- end }}
}

{{/* Range over all methods */}}
{{- end }}

{{ end }}