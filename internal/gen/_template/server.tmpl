{{- /*gotype: github.com/ogen-go/ogen/internal/gen.TemplateConfig*/ -}}

{{ define "server" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

// Handler handles operations described by OpenAPI v3 specification.
type Handler interface {
{{- range $op := $.Operations }}
	// {{ $op.Name }} implements {{ $op.Spec.OperationID }} operation.
	//
	// {{ $op.Spec.HTTPMethod }} {{ $op.Spec.Path }}
	{{ $op.Name }}(ctx context.Context {{ if $op.Request }}, req {{ $op.Request.Type.Go }}{{ end }}{{ if $op.Params }}, params {{ $op.Name }}Params {{ end }}) ({{ $op.Response.Type.Go }}, error)
{{- end }}
}

// Server implements http server based on OpenAPI v3 specification and
// calls Handler to handle requests.
type Server struct {
	h   Handler
	cfg config
}

func NewServer(h Handler, opts ...Option) *Server {
	srv := &Server{
		h:   h,
		cfg: newConfig(opts...),
	}
	return srv
}

// Register request handlers in router.
func (s *Server) Register(r chi.Router) {
	{{- range $op := $.Operations }}
	r.MethodFunc("{{ $op.Spec.HTTPMethod }}", "{{ $op.Spec.Path }}", s.Handle{{ $op.Name }}Request)
	{{- end }}
}

// DefaultMux returns new *chi.Mux with called Register method on it.
func (s *Server) DefaultMux() *chi.Mux {
	mux := chi.NewMux()
	s.Register(mux)
	return mux
}
{{ end }}
