{{- /*gotype: github.com/ogen-go/ogen/internal/gen.TemplateConfig*/ -}}
{{ define "request_decoders" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

{{/* Range over all methods */}}
{{- range $m := $.Methods }}
{{- if $m.RequestType }}
func decode{{ $m.Name }}Request(r *http.Request) (_ {{ $m.RequestType.Type }}, rerr error) {
    switch r.Header.Get("Content-Type") {
    {{- /* Range over all request types */ -}}
    {{- range $ctype, $schema := $m.RequestBody.Contents }}
    case "{{ $ctype }}":
        var request {{ $schema.Type }}
        {{- /* Decode json */ -}}
        {{- if eq $ctype "application/json" }}
        data, err := io.ReadAll(r.Body)
        if err != nil {
            rerr = err
            return
        }
        if err := json.Unmarshal(data, &request); err != nil {
            {{- if not $m.RequestBody.Required }}
            if errors.Is(err, io.EOF) {
                return
            }
            {{- end }}
            rerr = err
            return
        }

        {{- if $schema.NeedValidation }}
        if err := func() error {
            {{- template "validate_schema" dict
                "schema" $schema
                "varname" "request"
            }}
            return nil
        }(); err != nil {
            rerr = err
            return
        }
        {{- end }}

        return {{ if or (not $m.RequestBody.Required) ($m.IsRequestIface) }}&{{ end }}request, nil
        {{- /* Decode json */ -}}
        {{- else }}
        _ = request
        rerr = fmt.Errorf("{{ $ctype }} decoder not implemented")
        return
        {{- end }}
    {{- end }}
    {{- /* Range over all request types */}}
    default:
        rerr = fmt.Errorf("unexpected content-type: %s", r.Header.Get("Content-Type"))
        return
    }
}
{{- end }}
{{ end }}
{{/* Range over all methods */}}

{{ end }}
