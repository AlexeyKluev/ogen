{{- /*gotype: github.com/ogen-go/ogen/internal/gen.config*/ -}}
{{ define "request_encoders" }}
{{ $pkg := $.Package }}
{{ template "header" $ }}

{{/* Range over all methods */}}
{{- range $m := $.Methods }}
{{- if ne $m.RequestType "" }}
func Encode{{ $m.Name }}Request(req {{ $m.RequestType }}) ([]byte, string, error) {
    {{- $requestsLength := len $m.RequestBody.Contents }}
    {{- if eq $requestsLength 1 }}
    {{- range $ctype, $schema := $m.RequestBody.Contents }}
    
    {{- if eq $ctype "application/json" }}
    b, err := json.Marshal(req)
    if err != nil {
        return nil, "", err
    }

    return b, "{{ $ctype }}", nil
    {{- else }}
    return nil, "", fmt.Errorf("{{ $ctype }} encoder not implemented")
    {{- end }}
    
    {{- end }}
    {{- else }}
    {{- /* Multiple requests */}}
    switch req := req.(type) {
    {{- range $ctype, $schema := $m.RequestBody.Contents }}
    case *{{ $schema.Name }}:
        {{- if eq $ctype "application/json" }}
        b, err := json.Marshal(req)
        if err != nil {
            return nil, "", err
        }

        return b, "{{ $ctype }}", nil
        {{- else }}
        return nil, "", fmt.Errorf("{{ $ctype }} encoder not implemented")
        {{- end }}
    {{- end }}
    default:
        return nil, "", fmt.Errorf("unexpected request type: %T", req)
    }
    {{- end }}
}
{{- end }}
{{ end }}
{{/* Range over all methods */}}

{{ end }}
